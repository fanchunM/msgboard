STK.register("common.editor.getLength",function(a){return function(j){var d=41,l=140,b=20,e=j;var k=j.match(/(http:|https:)?\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];var c=0;for(var f=0,h=k.length;f<h;f++){var g=a.core.str.bLength(k[f]);if(/^(http:\/\/t.cn)|(https:\/\/t.cn)|(\/\/t.cn)/.test(k[f])){continue}else{if(/^(http:\/\/|https:\/\/|\/\/)+(t.sina.com.cn|t.sina.cn)/.test(k[f])||/^(http:\/\/|https:\/\/|\/\/)+(weibo.com|weibo.cn)/.test(k[f])){c+=g<=d?g:(g<=l?b:(g-l+b))}else{c+=g<=l?b:(g-l+b)}}e=e.replace(k[f],"")}var m=Math.ceil((c+a.core.str.bLength(e))/2);return m}});STK.register("kit.dom.cssText",function(b){var a=function(f,e){var c=(f+";"+e).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i))){c=c.replace(d[1]+d[2]+d[3],"")}return c};return function(d){d=d||"";var e=[],c={push:function(g,f){e.push(g+":"+f);return c},remove:function(g){for(var f=0;f<e.length;f++){if(e[f].indexOf(g+":")==0){e.splice(f,1)}}return c},getStyleList:function(){return e.slice()},getCss:function(){return a(d,e.join(";"))}};return c}});STK.register("common.listener",function(b){var c={};var a={};a.define=function(e,f){if(c[e]!=null){throw"common.listener.define: 频道已被占用"}c[e]=f;var d={};d.register=function(h,g){if(c[e]==null){throw"common.listener.define: 频道未定义"}b.listener.register(e,h,g)};d.fire=function(g,h){if(c[e]==null){throw"commonlistener.define: 频道未定义"}b.listener.fire(e,g,h)};d.remove=function(h,g){b.listener.remove(e,h,g)};d.cache=function(g){return b.listener.cache(e,g)};return d};return a});STK.register("kit.dom.isTurnoff",function(a){return function(b){return !(b.parentNode&&b.parentNode.nodeType!=11&&!b.disabled)}});STK.register("kit.extra.textareaUtils",function(c){var a={},b=document.selection;a.selectionStart=function(f){if(!b){try{return f.selectionStart}catch(j){return 0}}var k=b.createRange(),i,d,h=0;var g=document.body.createTextRange();g.moveToElementText(f);for(h;g.compareEndPoints("StartToStart",k)<0;h++){g.moveStart("character",1)}return h};a.selectionBefore=function(d){return d.value.slice(0,a.selectionStart(d))};a.selectText=function(d,e,f){d.focus();if(!b){d.setSelectionRange(e,f);return}var g=d.createTextRange();g.collapse(1);g.moveStart("character",e);g.moveEnd("character",f-e);g.select()};a.insertText=function(f,e,h,g){f.focus();g=g||0;if(!b){var i=f.value,k=h-g,d=k+e.length;f.value=i.slice(0,k)+e+i.slice(h,i.length);a.selectText(f,d,d);return}var j=b.createRange();j.moveStart("character",-g);j.text=e};a.replaceText=function(g,e){g.focus();var h=g.value;var k=a.getSelectedText(g);var f=k.length;if(k.length==0){a.insertText(g,e,a.getCursorPos(g))}else{var j=a.getCursorPos(g);if(b){var i=b.createRange();i.text=e;a.setCursor(g,j+e.length)}else{var d=j+k.length;g.value=h.slice(0,j)+e+h.slice(j+f,h.length);a.setCursor(g,j+e.length);return}}};a.getCursorPos=function(g){var f=0;if(STK.core.util.browser.IE){g.focus();var d=null;d=b.createRange();var e=d.duplicate();e.moveToElementText(g);e.setEndPoint("EndToEnd",d);g.selectionStart=e.text.length-d.text.length;g.selectionEnd=g.selectionStart+d.text.length;f=g.selectionStart}else{if(g.selectionStart||g.selectionStart=="0"){f=g.selectionStart}}return f};a.getSelectedText=function(e){var f="";var d=function(g){if(g.selectionStart!=undefined&&g.selectionEnd!=undefined){return g.value.substring(g.selectionStart,g.selectionEnd)}else{return""}};if(window.getSelection){f=d(e)}else{f=b.createRange().text}return f};a.setCursor=function(f,g,e){g=g==null?f.value.length:g;e=e==null?0:e;f.focus();if(f.createTextRange){var d=f.createTextRange();d.move("character",g);d.moveEnd("character",e);d.select()}else{f.setSelectionRange(g,g+e)}};a.unCoverInsertText=function(g,i,f){f=(f==null)?{}:f;f.rcs=f.rcs==null?g.value.length:f.rcs*1;f.rccl=f.rccl==null?0:f.rccl*1;var h=g.value,d=h.slice(0,f.rcs),e=h.slice(f.rcs+f.rccl,h==""?0:h.length);g.value=d+i+e;this.setCursor(g,f.rcs+(i==null?0:i.length))};return a});STK.register("module.at",function(g){var o=window,j=document,l=g.core.util.browser,b="font-family:Tahoma,宋体;",n=g.kit.extra.textareaUtils.selectionStart;var p;var c,h,e,k;var f=(function(){var d={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',b,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',b,'"> </span>'].join("")};return function(r){var q=r.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(s){return d[s]});return q}})();var a=function(){var d=[],r=p.textEl.style.cssText,q;g.foreach(["margin","padding","border"],function(s){g.foreach(["Top","Left","Bottom","Right"],function(u){var t;if(s!="border"){t=d.push(s,"-",u.toLowerCase(),":",g.getStyle(p.textEl,s+u),";");return}g.foreach(["Color","Style","Width"],function(v){d.push(s,"-",u.toLowerCase(),"-",v.toLowerCase(),":",g.getStyle(p.textEl,[s,u,v].join("")),";")})})});d.push("font-size:"+g.getStyle(p.textEl,"fontSize")+";");return g.kit.dom.cssText([r,d.join(""),b,"word-wrap: break-word;line-height: 18px;overflow-y:auto;overflow-x:hidden;outline:none;"].join("")).getCss()};var m=(function(){var v=g.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list;var q=v.wrap[0],w=v.flag[0],d=v.after[0],y=v.before[0],u=0,s,r,x;var t=function(z){if(l.MOZ){return -2}if(l.MOBILE&&l.SAFARI&&(l.IPAD||l.ITOUCH||l.IPHONE)){return -2}return 0};return{bind:function(){if(r===p.textEl){return}k=g.position(p.textEl);var z=["left:",k.l,"px;top:",k.t+20,"px;"].join("");r=p.textEl;var A=a();r.style.cssText=A;x=[z,A,"position:absolute;filter:alpha(opacity=0);opacity:0;z-index:-1000;"].join("");q.style.cssText=x;if(!u){u=1;j.body.appendChild(q)}},content:function(z,B,C,A){q.style.cssText=[x,"width:",((r.offsetWidth||parseInt(g.getStyle(r,"width")))+t()),"px;height:",((r.offsetHeight||parseInt(g.getStyle(r,"height")))),"px;overflow-x:hidden;overflow-y:",(/webkit/i.test(navigator.userAgent))?"hidden":g.getStyle(r,"overflowY"),";"].join("");y.innerHTML=f(z);w.innerHTML=f(B)||"&thinsp;";d.innerHTML=f([C,A].join(""));clearTimeout(s);s=setTimeout(function(){var D=g.position(w);g.custEvent.fire(p.eId,"at",{t:(D.t-r.scrollTop)-k.t+5,l:D.l-k.l+5,key:C,flag:B,textarea:p.textEl})},30)},hide:function(){q.style.display="none"},show:function(){q.style.display=""}}})();var i=function(){if(g.kit.dom.isTurnoff(p.textEl)){clearInterval(c);return}var d=p.textEl.value.replace(/\r/g,"");var t=n(p.textEl);if(t<0||t==e){return}e=t;var r=d.slice(0,t);var q=r.match(new RegExp(["(",p.flag,")([a-zA-Z0-9\u4e00-\u9fa5_]{0,20})$"].join("")));if(!q){g.custEvent.fire(p.eId,"hidden");return}var s=d.slice(t);r=r.slice(0,-q[0].length);m.content(r,q[1],q[2],s)};return function(q){if(!q||!q.textEl){return}q=g.parseParam({textEl:null,flag:"@",eId:g.custEvent.define({},["at","hidden"])},q);var r=function(){if(!p){return}clearInterval(c);g.removeEvent(p.textEl,"blur",r);m.hide()};var d=function(){r();p=q;e=null;m.bind();m.show();c=setInterval(i,200);g.addEvent(q.textEl,"blur",r)};g.addEvent(q.textEl,"focus",d);return q.eId}});STK.register("kit.extra.merge",function(a){return function(d,c){var f={};for(var e in d){f[e]=d[e]}for(var e in c){f[e]=c[e]}return f}});STK.register("core.str.trim",function(a){return function(e){if(typeof e!=="string"){throw"trim need a string as parameter"}var b=e.length;var d=0;var c=/(\u3000|\s|\t|\u00A0)/;while(d<b){if(!c.test(e.charAt(d))){break}d+=1}while(b>d){if(!c.test(e.charAt(b-1))){break}b-=1}return e.slice(d,b)}});STK.register("core.json.jsonToQuery",function(a){var b=function(d,c){d=d==null?"":d;d=a.core.str.trim(d.toString());if(c){return encodeURIComponent(d)}else{return d}};return function(g,e){var h=[];if(typeof g=="object"){for(var d in g){if(d==="$nullName"){h=h.concat(g[d]);continue}if(g[d] instanceof Array){for(var f=0,c=g[d].length;f<c;f++){h.push(d+"="+b(g[d][f],e))}}else{if(typeof g[d]!="function"){h.push(d+"="+b(g[d],e))}}}}if(h.length){return h.join("&")}else{return""}}});STK.register("common.log.monitor",function(e){var f=window.location.protocol=="https:"?"https:":"http:";var a=f+"//www.weibojs.com/log/widget.php";var d={refer:document.referrer,title:document.title,ua:window.navigator.userAgent,os:window.navigator.platform+"|"+window.navigator.oscpu};var c=true;var b=function(h){var g=new Image();if(c){g.src=h}else{}g=null};return function(h){var l={};var j=e.kit.extra.merge(d,h);var n=[];for(var g in j){var m=j[g];if(typeof m==="object"){m=e.core.json.jsonToQuery(m)}n.push(g+"="+encodeURIComponent(m))}var i=a+"?"+n.join("&");b(i);l.monitor=b;return l}});STK.register("kit.io.ajax",function(a){return function(i){var h,f,e,g,k,b,c;var j=function(m){a.common.log.monitor({url:document.location.protocol+"//"+document.location.hostname+(h.url.charAt(0)=="/"?h.url:"/"+h.url),param:h.args,method:h.method,result:m&&(m.code||0),httpcode:g.status})};b=function(m){k=false;i.onComplete(m,h.args);setTimeout(l,0)};c=function(m){k=false;i.onFail&&i.onFail(m,h.args);j(m);setTimeout(l,0)};e=[];g=null;k=false;h=a.parseParam({url:"",method:"get",responseType:"json",timeout:30*1000,onTraning:a.funcEmpty,isEncode:true},i);h.onComplete=b;h.onFail=c;var l=function(){if(!e.length){return}if(k===true){return}k=true;h.args=e.shift();g=a.ajax(h)};var d=function(n){while(e.length){e.shift()}k=false;if(g){try{g.abort()}catch(m){}}g=null};f={};f.request=function(m){if(!m){m={}}if(i.noQueue){d()}if(!i.uniqueRequest||!g){e.push(m);m._t=0;l()}};f.abort=d;return f}});STK.register("kit.io.jsonp",function(a){return function(d){var c,f,b,h,e;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:30*1000,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:true},d);b=[];h={};e=false;var g=function(){if(!b.length){return}if(e===true){return}e=true;h.args=b.shift();h.onComplete=function(i){e=false;c.onComplete(i,h.args);setTimeout(g,0)};h.onFail=function(i){e=false;c.onFail(i);setTimeout(g,0)};a.jsonp(a.kit.extra.merge(c,{args:h.args,onComplete:function(i){h.onComplete(i)},onFail:function(i){try{h.onFail(i)}catch(j){}}}))};f={};f.request=function(i){if(!i){i={}}b.push(i);i._t=1;g()};f.abort=function(i){while(b.length){b.shift()}e=false;h=null};return f}});STK.register("kit.io.inter",function(a){return function(){var b,d,c;b={};d={};c={};b.register=function(f,e){if(d[f]!==undefined){throw f+" interface has been registered"}d[f]=e;c[f]={}};b.hookComplete=function(e,g){var f=a.core.util.getUniqueKey();c[e][f]=g;return f};b.removeHook=function(e,f){if(c[e]&&c[e][f]){delete c[e][f]}};b.getTrans=function(g,e){var f=a.kit.extra.merge(d[g],e);f.onComplete=function(i,l){try{e.onComplete(i,l)}catch(j){}if(i.code==="100000"){try{e.onSuccess(i,l)}catch(j){}}else{try{e.onError(i,l)}catch(j){}}for(var h in c[g]){try{c[g][h](i,l)}catch(j){}}};if(d[g]["requestMode"]==="jsonp"){return a.kit.io.jsonp(f)}else{if(d[g]["requestMode"]==="ijax"){return a.kit.io.ijax(f)}else{return a.kit.io.ajax(f)}}};b.request=function(h,e,g){var f=a.core.json.merge(d[h],e);f.onComplete=function(j,m){try{e.onComplete(j,m)}catch(l){}if(j.code==="100000"){try{e.onSuccess(j,m)}catch(l){}}else{try{if(j.code==="100002"){window.location.href=j.data;return}e.onError(j,m)}catch(l){}}for(var i in c[h]){try{c[h][i](j,m)}catch(l){}}};f=a.core.obj.cut(f,["noqueue"]);f.args=g;if(d[h]["requestMode"]==="jsonp"){return a.jsonp(f)}else{if(d[h]["requestMode"]==="ijax"){return a.ijax(f)}else{return a.ajax(f)}}};return b}});STK.register("common.trans.editor",function(c){var d=(location.host=="widget.weibo.com"||location.host=="dev.weibo.com")?"":"/widget";var a=c.kit.io.inter();var b=a.register;b("face",{url:d+"/public/aj_getemotions.php"});b("at",{url:d+"/public/aj_atusers.php"});return a});STK.register("module.suggest",function(j){var h=null,e=j.custEvent,l=e.define,f=e.fire,o=e.add,g=j.addEvent,c=j.removeEvent,m=j.stopEvent;var b=[],a={};var i={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9};var k=function(w){var v=-1,t=[],r=w.textNode,s=w.uiNode;var A=j.core.evt.delegatedEvent(s);var p=l(r,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);p.setFlag=q;var q=function(B){w.flag=B};var y=function(){return j.sizzle(["[action-type=",w.actionType,"]"].join(""),s)};var z=function(){v=-1;c(r,"keydown",u);A.destroy()};var u=function(D){var E,C;if(!(E=D)||!(C=E.keyCode)){return}if(C==i.ENTER){m();f(p,"onSelect",[v,r,w.flag]);return false}if(C==i.UP){m();var B=y().length;v=v<1?B-1:v-1;f(p,"onIndexChange",[v]);return false}if(C==i.DOWN){m();var B=y().length;v=v==(B-1)?0:v+1;f(p,"onIndexChange",[v]);return false}if(C==i.ESC){m();z();f(p,"onClose");return false}if(C==i.TAB){z();f(p,"onClose");return false}};var x=function(B){f(p,"onSelect",[j.core.arr.indexOf(B.el,y()),r,w.flag])};var n=function(B){v=j.core.arr.indexOf(B.el,y());f(p,"onIndexChange",[j.core.arr.indexOf(B.el,y())])};o(p,"open",function(C,B){r=B;z();g(B,"keydown",u);A.add(w.actionType,"mouseover",n);A.add(w.actionType,"click",x);f(p,"onOpen",[w.flag])});o(p,"openSetFlag",function(C,B){q(B)});o(p,"close",function(){z();f(p,"onClose",[w.flag])});o(p,"indexChange",function(B,C){v=C;f(p,"onIndexChange",[v,w.flag])});return p};var d=function(n){var p=n.textNode;var q=j.core.arr.indexOf(p,b);if(!a[q]){b[q=b.length]=p;a[q]=k(n)}return a[q]};return function(n){if(!n.textNode||!n.uiNode){return}n=j.parseParam({textNode:h,uiNode:h,actionType:"item",actionData:"index",flag:""},n);return d(n)}});STK.register("common.channel.at",function(b){var a=["open","close"];return b.common.listener.define("common.channel.at",a)});STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b,c){var d=a.core.util.language(b,$LANG);d=d.replace(/\\}/ig,"}");if(c){d=a.templet(d,c)}return d}});STK.register("kit.dom.firstChild",function(b){var a=b.core.dom.next;return function(c){var d=c.firstChild;if(d&&d.nodeType!=1){d=a(d)}return d}});STK.register("kit.dom.layoutPos",function(a){return function(e,c,b){if(!a.isNode(c)){throw"kit.dom.layerOutElement need element as first parameter"}if(c===document.body){return false}if(!c.parentNode){return false}if(c.style.display==="none"){return false}var g,f,i,k,h,j,d;g=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},b);f=c;if(!f){return false}while(f!==document.body){f=f.parentNode;if(f.style.display==="none"){return false}j=a.getStyle(f,"position");d=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed"){break}if(d==="true"&&j==="relative"){break}}f.appendChild(e);i=a.position(c,{parent:f});k={w:c.offsetWidth,h:c.offsetHeight};h=g.pos.split("-");if(h[0]==="left"){e.style.left=i.l+g.offsetX+"px"}else{if(h[0]==="right"){e.style.left=i.l+k.w+g.offsetX+"px"}else{if(h[0]==="center"){e.style.left=i.l+k.w/2+g.offsetX+"px"}}}if(h[1]==="top"){e.style.top=i.t+g.offsetY+"px"}else{if(h[1]==="bottom"){e.style.top=i.t+k.h+g.offsetY+"px"}else{if(h[1]==="middle"){e.style.top=i.t+k.h/2+g.offsetY+"px"}}}return true}});STK.register("common.editor.plugin.at",function(e){var y=e.kit.extra.language;var l='<div class="WB_tips_smart WB_email"><p class="tipsmt_title" node-type="suggestTitle">想用@提到谁</p><ul class="tipsmt_list" node-type="suggestWrap"></ul></div>';var f={"@":{normalTitle:y("#L{选择昵称或轻敲空格完成输入}"),moreTitle:y("#L{选择最近@的人或直接输入}"),noTilte:y("#L{轻敲空格完成输入}")},"#":{normal:y("#L{想用什么话题？}")}};var n={"@":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="tipsmt_cur" </#if>action-data="value=${list.nickname}" value="${list.nickname}"><a href="#">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'};var i,k,u,g,c,p,x,j=false,m;var t;var s={"@":"at","#":"topicList"};var d=0;var h=function(){setTimeout(function(){e.custEvent.fire(i,"close")},200)};var a=function(){p.style.display="none"};var o=function(){e.custEvent.add(i,"onIndexChange",function(A,z){q(z)});e.custEvent.add(i,"onSelect",function(z,F,J,H){d=0;e.core.evt.stopEvent();var M=t[F].getAttribute("value");M=M.replace(/\(.*\)/,"");try{J.focus()}catch(G){}var L=e.kit.extra.textareaUtils.selectionStart(J)*1;var A=new RegExp(H+"([a-zA-Z0-9\u4e00-\u9fa5_]{0,20})$");var B=J.value.replace(/\r+/g,"").slice(0,L).match(A);var D=J.value.slice(L,L+1);B=(B&&B[1])?B[1].length:0;var I=e.kit.extra.textareaUtils;if(H=="#"){if(typeof D!="undefined"&&D!=H){M=M+H+" "}}else{M=M+" "}I.insertText(J,M,L,B);var C=I.getCursorPos(J);if(H=="#"&&D==H){I.setCursor(J,C+1);I.insertText(J," ",C+1,0)}C=I.getCursorPos(J);var K=I.getSelectedText(J);var E=(K==""||K==null)?0:K.length;J.setAttribute("range",C+"&"+E);e.custEvent.fire(i,"close")});e.addEvent(u.textEl,"blur",h);e.custEvent.add(i,"onClose",a);e.custEvent.add(i,"onOpen",function(A,z){c.style.display="";p.style.display="";j=true;setTimeout(function(){e.custEvent.fire(i,"indexChange",0)},100)})};var w=function(z,B,C){if(z=="@"){if(B.data&&B.data.length>0){B.title=(C==""?f[z]["moreTitle"]:f[z]["normalTitle"])}else{B.title=f[z]["noTilte"]}}else{B.title=f[z]["normalTitle"]}var A=e.core.util.easyTemplate(n[z],B);return A};var v=function(){e.core.evt.custEvent.add(k,"hidden",function(z,A){e.custEvent.fire(i,"close")});e.core.evt.custEvent.add(k,"at",function(B,C){x=C.key;var z=C.flag;if(x.length==0&&z!="@"){e.custEvent.fire(i,"close");return}var A=document.location.host=="widget.weibo.com"?"":"/widget";e.core.io.ajax({url:A+"/public/aj_atusers.php",args:{wsrc:$CONFIG.wsrc||"app_comment_box",appkey:$CONFIG.source_appkey||$CONFIG.appkey||$CONFIG.app_src,q:x},onComplete:function(E){if(E.code=="100000"){var D=w(z,E,x);e.custEvent.fire(i,"openSetFlag",z);e.custEvent.fire(i,"open",C.textarea);var F=e.core.dom.builder(D);var G=F.box;c.innerHTML=G;c.style.display=(E.data.length==0)?"none":"";g.innerHTML=(x.length==0)?f["@"].moreTitle:f["@"].normalTitle;p.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");e.common.channel.at.fire("open");e.kit.dom.layoutPos(p,C.textarea,{pos:"left-top",offsetX:C.l,offsetY:C.t})}else{e.custEvent.fire(i,"close")}},onFail:function(){e.custEvent.fire(i,"close")}})})};var b=function(){m=u.textEl;k=STK.module.at({textEl:m,flag:"@"})};var r=function(A){d=0;p&&(p.style.display="none");p&&(p.innerHTML="");var z=e.builder(l);p=e.kit.dom.firstChild(z.box);p.style.display="none";document.body.appendChild(p);g=z.list.suggestTitle[0];c=z.list.suggestWrap[0];i&&(e.custEvent.fire(i,"close"));i&&(e.custEvent.remove(i));i=e.module.suggest({textNode:A,uiNode:c,actionType:"item",actionData:"value",flag:"@"});o()};var q=function(z){t=e.sizzle("li",c);t&&t[0]&&e.core.dom.removeClassName(t[d],"tipsmt_cur");e.core.dom.addClassName(t[z],"tipsmt_cur");d=z};return function(A,z){u=A.nodeList;var B={};B.init=function(){b();r(u.textEl);v()};return B}});STK.register("common.editor.simpleEditorNew",function(e){var a=e.core.str.trim,d;var c=e.common.editor.getLength;var b=function(j,h){var i=c(j);var g=Math.abs(h-i);var f;if(i>h||i<1){f={wordsnum:i,vnum:g,overflow:true}}else{if(i==0){f={wordsnum:i,vnum:g,overflow:true}}else{f={wordsnum:i,vnum:g,overflow:false}}}return f};return function(i,k){k=k||{};var g=k.limit||140;if(!i){throw"[easyEditor]: editor is null"}e.custEvent.define(i,"textNum");e.custEvent.define(i,"keyUpCount");var l=e.sizzle('[node-type="editor"]',i)[0];var h=e.sizzle('[node-type="wordNum"]',i)[0];if(k.atSwitch!=null&&k.atSwitch==true){var f=e.common.editor.plugin.at({nodeList:{textEl:l}},k);f.init()}e.addEvent(l,"focus",function(){d=setInterval(function(){j()},200)});e.addEvent(l,"blur",function(){d&&clearInterval(d)});var j=function(){var n=(a(l.value).length==0)?a(l.value):l.value;n=n.replace(/\r\n/g,"\n");var m=b(n,g);if(n.length>=0&&l.focus){if(m.overflow&&m.wordsnum!=0){h.className=k.warnClassName?k.warnClassName:"WB_tipS_numWarn"}else{h.className=k.className?k.className:"WB_tipS_num"}}else{if(n.length===0){h.className=k.className?k.className:"WB_tipS_num"}}if(n.length!==0&&m.overflow){h.innerHTML="-"+(m.vnum>100?"n":m.vnum)}else{h.innerHTML=m.wordsnum}e.custEvent.fire(i,"textNum",{count:m.wordsnum,isOver:m.overflow})};e.addEvent(l,"keyup",j);e.custEvent.add(i,"keyUpCount",j);j()}});if(typeof scope==="undefined"){scope={}}scope.loginKit=function(){if(window.scope){var c=window.scope.current_user_weibo||window.scope.current_user_sina;if(c){return{uid:c,isLogin:!!c}}}if(window.$CONFIG){var c=window.$CONFIG.current_user_weibo||window.$CONFIG.current_user_sina||window.$CONFIG.uid||window.$CONFIG.$uid;if(c){return{uid:c,isLogin:!!c}}}var b=document.cookie+";";var f=["SUP","=([^;]*)?;"].join("");var a=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var e=b.match(new RegExp(f,"i"));e=(e)?e[1]||"":"";e=unescape(e);var c=e.match(new RegExp(a));c=(c)?c[2]||"":"";var d=scope["$oid"];return{uid:c,isLogin:!!c,isAdmin:c&&d&&(c==d)}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};STK.register("common.editor.flashContent",function(a){return function(j,i,p,o){i=i||["#fee","#fdd","#fcc","#fdd","#fee","transparent"];p=p||2;o=o||50;var n=0,k=i.length,m=p*k,l=setInterval(function(){j.style.backgroundColor=i[n%k];n++;n==m&&clearInterval(l)},o)}});STK.register("common.trans.live",function(d){var a=d.kit.io.inter();var b=a.register;var c="";if(location.host!="widget.weibo.com"){c="/widget"}b("addmblog",{url:c+"/livestream/addmblog.php",method:"post"});b("comment",{url:c+"/livestream/comment.php",method:"post"});b("repost",{url:c+"/livestream/repost.php",method:"post"});b("oldfromsearch",{url:c+"/livestream/getoldfromsearch.php ",method:"get"});b("relations",{url:c+"/livestream/aj_getrelations.php",method:"post"});b("addFollow",{url:c+"/livestream/aj_attention.php",method:"post"});return a});STK.register("module.tabs",function(a){return function(e,l){var k,g,j,f,n,i,h;var d=a.parseParam({evtType:"click",tabNode:"",boxNode:"",className:"current",callback:function(){},defaultIndex:0},l);function c(r){if(r==h){return}var q=(a.isArray(j))?j[r]:j,o=k[r],p=a.isArray(g)?g[r]:null;if(p){a.setStyle(g[h],"display","none");a.setStyle(g[r],"display","")}a.removeClassName(k[h],n);a.addClassName(k[r],n);q({index:r,tabNode:o,boxNode:p});h=r}function b(){if(!a.isArray(k)){throw"module.tab needs tabNode as Array!"}if(d.boxNode!==""){if(!a.isArray(g)){throw"module.tab needs tabNode as Array!"}if(k.length!=g.length){throw"module.tab needs tabNode'length equal to boxNode'length!"}}}function m(q,p){j=p.callback;n=p.className;h=p.defaultIndex;k=(typeof p.tabNode=="string")?a.sizzle(p.tabNode,q):p.tabNode;i=k.length;if(p.boxNode!==""){g=(typeof p.boxNode=="string")?a.sizzle(p.boxNode,q):p.boxNode}b();for(var o=0;o<i;o++){a.addEvent(k[o],p.evtType,function(r){return function(){a.preventDefault();c(r)}}(o))}}m(e,d)}});STK.register("common.diy.live",function(a){return function(d,c,e,i){var g={};var f=function(m){m=m||a.getEvent(m);var l=m.target||m.srcElement,k=a.sizzle(c,d),j=k.length;while(j--){if(k[j]==l||a.contains(k[j],l)){i.call(k[j],m);break}}};var h=function(){b()};var b=function(){a.addEvent(d,e,f)};g.destroy=function(){a.removeEvent(d,e,f);d=null};h();return g}});STK.register("kit.dom.parseDOM",function(a){return function(c){for(var b in c){if(c[b]&&(c[b].length==1)){c[b]=c[b][0]}}return c}});STK.register("common.editor.simpleEditor",function(e){var a=e.core.str.trim,d;var c=e.common.editor.getLength;var b=function(j,h){var i=c(j);var g=Math.abs(h-i);var f;if(i>h||i<1){f={wordsnum:i,vnum:g,overflow:true}}else{if(i==0){f={wordsnum:i,vnum:g,overflow:true}}else{f={wordsnum:i,vnum:g,overflow:false}}}return f};return function(i,k){k=k||{};var g=k.limit||140;if(!i){throw"[easyEditor]: editor is null"}e.custEvent.define(i,"textNum");e.custEvent.define(i,"keyUpCount");var l=e.sizzle('[node-type="editor"]',i)[0];var h=e.sizzle('[node-type="wordNum"]',i)[0];if(k.atSwitch!=null&&k.atSwitch==true){var f=e.common.editor.plugin.at({nodeList:{textEl:l}},k);f.init()}e.addEvent(l,"focus",function(){d=setInterval(function(){j()},200)});e.addEvent(l,"blur",function(){d&&clearInterval(d)});var j=function(){var n=(a(l.value).length==0)?a(l.value):l.value;n=n.replace(/\r\n/g,"\n");var m=b(n,g);if(n.length>=0&&l.focus){if(m.overflow&&m.wordsnum!=0){h.className=k.warnClassName?k.warnClassName:"WB_tipS_numWarn"}else{h.className=k.className?k.className:"WB_tipS_num"}}else{if(n.length===0){h.className=k.className?k.className:"WB_tipS_num"}}if(n.length!==0&&m.overflow){h.innerHTML="-"+(m.vnum>100?"n":m.vnum)}else{h.innerHTML=m.vnum}e.custEvent.fire(i,"textNum",{count:m.wordsnum,isOver:m.overflow})};e.addEvent(l,"keyup",j);e.custEvent.add(i,"keyUpCount",j);j()}});STK.register("common.widget.showEditor",function(f){var d=f.kit.extra.language,c=f.addEvent,b=f.common.editor.getLength,e=f.common.editor.flashContent,g=f.removeEvent;var a={focus:true,type:"repost",template:'<#et temp data><div class="liveStream_mainFeed_list_comment" style="display:block;" node-type="outer"><div class="liveStream_mainFeed_listArrow W_bgcolor_arrow" style="margin-right:47px;" node-type="arrow"><em class="liveStream_mainFeed_listArrowArrline">◆</em><span>◆</span></div><div class="liveStream_mainFeed_list_commentInput" node-type="publisher"><div class="commentInput_area"><textarea class="WB_textarea" node-type="editor">${data.text}</textarea><p class="commentInput_state" style="display:none;" node-type="error"><span class="WB_tipS_err commentInput_state_icon"></span><span node-type="tip_error">#L{发表微博失败}</span><a href="###" node-type="back">#L{返回}</a></p><p class="commentInput_state" style="display:none;" node-type="success"><span class="WB_tipS_ok commentInput_state_icon"></span><span node-type="tip_success">#L{发布成功}</span></p></div><div class="commentInput_action clearfix"><div class="commentInput_actionRetweet"><p class="commentInput_actionRe"><input type="checkbox" node-type="check" id="checkIt" /><label for="checkIt" node-type="more">#L{同时评论}</label></p></div><div class="commentInput_actionButton"><p class="commentInput_actionSub"><a href="###" class="WB_btnA" node-type="sendBtn"><span>#L{转发}</span></a></p><p class="commentInput_actionFont"><span class="txt_num" node-type="wordNum">140</span>#L{字}</p></div></div></div></div></#et>',forward:"",uname:"",callback:function(){}};return function(l,h){var o,m,k,q={};var u="";a=f.parseParam(a,h);if(l&&typeof l==="string"){l=f.E(l)}else{if(l.nodeType!==1){throw"[common.widget.showEditor] node.nodeType wrong!"}}var v={text:""};if(a.type==="repost"){a.uname=decodeURIComponent(a.uname);var r=a.forward?"//@"+a.uname+"："+decodeURIComponent(a.forward||""):"";v.text=r}var n=function(x){a=f.parseParam(a,x);if(a.type==="comment"){k.more.innerHTML=d("#L{同时转发}");k.sendBtn.innerHTML=d("<span>#L{评论}</span>");k.editor.value=decodeURIComponent(a.forward)}};var j=function(){var z=f.trim(k.editor.value),x=b(z);if(x>140||x===0){e(k.editor);return false}var y=k.check.checked;typeof a.callback==="function"&&a.callback.call(q,z,y)};var w=function(){i();p();s()};var s=function(){l.parentNode.appendChild(m.box);k=f.kit.dom.parseDOM(f.builder(l.parentNode).list);if(a.focus){f.kit.extra.textareaUtils.setCursor(k.editor,0,0)}f.common.editor.simpleEditor(k.publisher,{warnClassName:"txt_num err_num",className:"txt_num"})};var i=function(){o=f.core.util.easyTemplate(d(a.template),v).toString();m=f.core.dom.builder(o);k=f.kit.dom.parseDOM(m.list)};var p=function(){if(a.type==="comment"){k.more.innerHTML=d("#L{同时转发}");k.sendBtn.innerHTML=d("<span>#L{评论}</span>")}c(k.back,"click",t);c(k.sendBtn,"click",j);f.core.evt.hotKey.add(k.editor,"ctrl+Enter",j)};var t=function(){k.error.style.display="none";k.editor.value=u};q.showError=function(x){if(x){k.tip_error.innerHTML=x}k.error.style.display="";u=k.editor.value;k.editor.value="";setTimeout(function(){k&&(k.error.style.display="none")},3000)};q.clear=function(){u="";k.editor.value=""};q.showSuccess=function(x){if(x){k.tip_success.innerHTML=x}q.clear();k.success.style.display="";setTimeout(function(){k&&(k.success.style.display="none")},3000)};q.setArrow=function(x){k.arrow.style.marginRight=x+"px"};q.getNodes=function(){return k};q.show=s;q.hide=function(x){if(!k){return}k.outer.style.display="none";if(x){this.destroy()}};q.focus=function(x){f.kit.extra.textareaUtils.setCursor(k.editor,x,0)};q.destroy=function(){g(k.back,"click",t);g(k.sendBtn,"click",j);f.core.evt.hotKey.remove(k.editor,"ctrl+Enter",j);f.removeNode(k.outer);for(var x in k){k[x]=null}k=null};w();q.reInit=n;q.pubNodes=k;return q}});STK.register("core.obj.parseParam",function(a){return function(d,c,b){var e,f={};c=c||{};for(e in d){f[e]=d[e];if(c[e]!=null){if(b){if(d.hasOwnProperty[e]){f[e]=c[e]}}else{f[e]=c[e]}}}return f}});STK.register("common.widget.log",function(b){var a={app_sharebutton:1,app_followbutton:2,app_livestream:4,app_listweibo:5,app_weiboshow:6,app_commentbox:7};return function(i){var e=b.core.obj.parseParam({vsrc:"app_weiboshow",refer:"",step:1},i);var g=scope.refer||scope.$refer||e.refer,f=scope.loginKit().uid||"",h=(scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0),c=a[e.vsrc]||"";var j="//rs.sinajs.cn/r.gif?uid="+f+"&appid="+h+"&refer="+g+"&cat="+c+"&step="+e.step+"&rnd="+(+new Date());var d=new Image();d.src=j;d=null}});STK.register("common.widget.login",function(b){var a={vsrc:"app_weiboshow",appsrc:"",showlogo:0,callback:function(){}};if(typeof App==="undefined"){App={}}return function(f){f=b.parseParam(a,f);if(!f.appsrc){f.appsrc=scope?(scope.appsrc?scope.appsrc:(scope.$appsrc?scope.$appsrc:"")):""}var e={};App.loginBackUrlCallBack=function(j){b.custEvent.fire(e,"login",j);f.step=2;b.common.widget.log(f)};var i=function(){g();c();h();d()};var g=function(){};var c=function(){};var h=function(){b.custEvent.define(e,"login")};var d=function(){b.custEvent.add(e,"login",function(j){f.callback(j)})};e.showLogin=function(){var m="&"+b.jsonToQuery(f);var l=navigator.userAgent.indexOf("360 Aphone Browser")>=0;var n=/micromessenger\/(\d+\.\d+\.\d+)/i.test(navigator.userAgent);if(l||n){location.href="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl="+encodeURIComponent(location.href)+m+"&rnd="+(+new Date().valueOf());return}var k="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html"+m+"&rnd="+(+new Date().valueOf());if(/weibo.com/.test(location.host)){k=k.replace(/\/widget/,"")}var j=window.open(k,"miniblog_login",["toolbar=1,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));j.focus();b.common.widget.log(f)};i();return e}});STK.register("comp.widget.live.repost_comm",function(h){var d=h.common.diy.live,c=h.kit.extra.language,n=h.common.editor.getLength,k=h.common.widget.showEditor,g=h.addEvent,b=h.common.editor.flashContent,i=h.common.trans.live;var j,a;var f=function(q,t,r,v,s){var p=arguments;if(!scope.loginKit().isLogin){var w=h.common.widget.login({vsrc:"app_livestream",appsrc:scope.appsrc});h.custEvent.add(w,"login",function(){f.apply(this,p)});w.showLogin()}var u={content:t+(scope.refer_content?scope.refer_content:""),issync:r?1:0,mid:s.mid,appkey:scope.appkey,language:scope.$language,refer:scope.refer,srcuid:s.srcuid},x;if(v=="repost"){u.com_content=s.forward}x=i.getTrans(v,{onComplete:function(y){switch(y.code){case"A00006":j.showSuccess(c("#L{发布成功}"));o(q);break;case"M01155":j.showError(y.msg||c("#L{不要太贪心哦！你已经发过一次啦。}"));break;default:j.showError(y.msg||c("#L{发微博失败，请稍后再试！}"));break}}});x.request(u)};var o=function(p){var q=p.innerHTML;if(/\((\d+)\)/.test(q)){q=q.replace(/(\d+)/,(+RegExp.$1)+1)}else{q+="(1)"}p.innerHTML=q};var e=0,m="";var l=function(t,w){w=w||"repost";var v=t.getAttribute("data");v=h.queryToJson(v);if(v.mid===e&&m===w){if(j&&j.hide){e=0;m="";j.hide(true);j=null}return}e=v.mid;m=w;var y=h.E("mid"+v.mid),s={uname:v.uname,type:w,callback:function(r,A){f(t,r,A,w,v)},forward:v.forward};if(j&&j.hide){j.hide(true);j=null}j=k(y,s);var x=h.position(t);var z=h.core.dom.getSize(t);var q=h.position(y);var u=h.core.dom.getSize(y);var p=u.width-(z.width/2)-(x.l-q.l)-10;j.setArrow(p)};return function(v){var u={},q,s;var w=function(){p()};var r=function(){};var p=function(){q=d(v,'[node-type="repost"]',"click",function(x){h.stopEvent(x);l(this,"repost");return false});s=d(v,'[node-type="comment"]',"click",function(x){h.stopEvent(x);l(this,"comment");return false})};var t=function(){s.destroy();q.destroy()};w();u.destroy=t;return u}});STK.register("comp.widget.live.style",function(d){var c=(function(){var f=false;if(window.attachEvent){window.attachEvent("onload",function(){f=true})}return function(h){function g(){var i=document.createElement("style");i.type="text/css";if(d.IE){i.styleSheet.cssText=h}else{var j=document.createDocumentFragment();j.appendChild(document.createTextNode(h));i.appendChild(j)}document.getElementsByTagName("head")[0].appendChild(i)}if(!d.IE||f){g()}else{window.attachEvent("onload",function(){f=true;g()})}}})();var b=scope.$url_params||location.href;var e=function(){var j="";var i=/colordiy=(\d+)/.test(b)?RegExp.$1:0;var g=/color=([A-Fa-f\d,]+)/.test(b)?RegExp.$1:"";if(g&&i==1){g=g.split(",");if(g[0]){j+="\n .liveStream * ,		    .liveStream .liveStream_vline,		    .liveStream .liveStream_topborder,		    .liveStream .liveStream_topborder p,		    .liveStream .liveStream_followList_have{border-color:#"+g[0]+";}"}if(g[1]){j+="\n .liveStream .liveStream_topborder, .liveStream .liveStream_title,.liveStream .liveStream_main_tab li a,.liveStream .liveStream_mainFeed_list_commentInput {background:#"+g[1]+";}"}if(g[2]){j+="\n .liveStream, .liveStream .liveStream_main_tab li.current a,\n.liveStream .commentInput_action .commentInput_actionFont .txt_num,\n.liveStream .commentInput_actionFont{color:#"+g[2]+";}"}if(g[3]){j+="\n .liveStream a,.liveStream .liveStream_main_feedMore a,		    .liveStream .WB_linkA a,.liveStream .WB_linkB a,.liveStream .WB_linkB,		    .liveStream .WB_linkA{color:#"+g[3]+";}"}if(g[4]){j+="\n .liveStream .liveStream_main_height{background:#"+g[4]+";}		    	.liveStream .liveStream_main_tab li.current a {background:#"+g[4]+";}"}if(g[5]){j+="\n .liveStream .liveStream_publishbox {background:#"+g[5]+";}";j+="\n .liveStream .liveStream_main_header {background:#"+g[5]+";}";j+="\n .liveStream .liveStream_main_feedMore a{background-color:#"+g[5]+";}";j+="\n .liveStream .liveStream_mainFeed_list:hover, .liveStream .liveStream_mainFeed_list_focus, .liveStream .liveStream_main_allList:hover, .liveStream .liveStream_main_allList_focus, .liveStream .liveStream_follow{background:#"+g[5]+";}"}}var h=/border=(\d+)/.test(b)?RegExp.$1:1;if(h==0){d.E("pl_live").className="WB_widgets liveStream liveStream_noborder"}var f=/titlebar=(\d+)/.test(b)?RegExp.$1:1;if(f==0){j+="\n .liveStream_title_top{display:none;}"}if(j){c(j)}};var a=function(){var j=/height=(\d+)/.test(b)?parseInt(RegExp.$1):500;j=j>800?800:j<75?75:j;var h=/border=(\d+)/.test(b)?RegExp.$1:1;if(h!=0){j-=2}var g=/titlebar=(\d+)/.test(b)?RegExp.$1:1;if(g!=0){j-=30}else{j-=1}var k=/publish=(\d+)/.test(b)?RegExp.$1:1;if(k!=0){j-=89+30-18}else{j-=30}if(d.E("pl_live_fans")){j-=100}j=Math.max(j,0);d.E("live_content").style.height=j+"px";var l=d.sizzle(".liveStream_main_errorBox");if(l.length){for(var m=0,f=l.length;m<f;m++){l[m].style.height=j+"px"}}};return function(i,h){var g={};var j=function(){e();a()};var f=function(){};j();g.destroy=f;return g}});STK.register("comp.widget.live.loadmore",function(i){var g=function(q){var s=[],p=q.length;for(var r=0;r<p;r++){s.push(q[r])}return s};scope.page={search:2,list:2};var j=i.foreach,l=false,e=i.kit.extra.language,b=scope.$url_params||location.href,n=function(q,p){return q.getElementsByTagName(p)},o,k,f=[],h=30000,a=(location.host=="widget.weibo.com")?"":"/widget",d=[{url:a+"/livestream/getnewfromsearch.php",oldurl:a+"/livestream/getoldfromsearch.php",topic:scope.topic||-1,mid:scope.mid,delmid:"",type:"search",pic:/pic=0/.test(b)?"0":1,start:20},{url:a+"/livestream/getlistnewfromlist.php",oldurl:a+"/livestream/getlistoldfromlist.php",sinceid:scope.sinceid,uid:scope.listuid,mid:scope.mid,type:"list",maxid:scope.maxid,pic:/pic=0/.test(b)?"0":1,listid:scope.listid||-1}];if(scope.loadtimeInterval){h=scope.loadtimeInterval}else{if(/ltime=(\d+)/.test(b)){h=parseInt(RegExp.$1)}}if(/atalk=0/.test(b)){d[0]=d[1]}scope.$spr=scope.$spr||"";var c=function(p,r,q){var s=0,t=false;var u=d[q];if(u.topic===-1||u.listid===-1){r.style.display="none";return}else{r.style.display=""}i.addEvent(r,"click",function(){if(t){return}t=true;r.innerHTML=e("#L{加载中...}");var v={spr:scope.$spr,start:i.sizzle("div.liveStream_mainFeed_list",p).length-scope.pubCount,uid:scope.listuid,language:$CONFIG.$language,appkey:scope.appkey,refer:scope.refer,dup:scope.$dup,antispan:scope.$antispam,isOutTopicSearch:scope.$isOutTopicSearch,dpc:1};"maxid topic mid listid pic sinceid uid".replace(/\S+/g,function(w){if(u[w]){v[w]=u[w]}});if(typeof u.delmid!="undefined"){v.delmid=scope.delMids.join(",")}v.page=scope.page[u.type];i.ajax({url:u.oldurl,args:v,onComplete:function(x){if(x.code=="A00008"){r.innerHTML=e("#L{没有更多微博了}");setTimeout(function(){i.removeNode(r)},3000)}else{if(x.code==="A00006"){t=false;if(x.html){var y=i.C("DIV");y.innerHTML=x.html;var w=i.sizzle("div.liveStream_mainFeed_list",y);p.insertBefore(y,r.parentNode)}if(x.maxid){u.maxid=x.maxid}r.innerHTML=e("#L{点击查看更多}");if(s>=2){i.removeNode(r)}v.page=scope.page[u.type]++;s++}else{r.innerHTML=e("#L{加载出错，点击重试}")}}},onFail:function(w){t=false;r.innerHTML=e("#L{加载出错，点击重试}")}})})};var m=function(p,s){var r=d[s];if(r.topic===-1||r.listid===-1){return}f[s]=[];var t=function(){var w=d[s];var y={spr:scope.$spr,dpc:1,appkey:scope.appkey,refer:scope.refer,language:$CONFIG.$language};"sinceid topic mid uid pic listid maxid".replace(/\S+/g,function(z){if(w[z]){y[z]=w[z]}});if(typeof w.delmid!="undefined"){y.delmid=scope.delMids.join(",")}if(w.uid){y.start=i.sizzle("div.liveStream_mainFeed_list",p).length-scope.pubCount}y.url_random=0;var v=function(E){"sinceid mid".replace(/\S+/g,function(F){if(E[F]){w[F]=E[F]}});if(E.delmid){var B=scope.delMids;scope.delMids=[];for(var z=B.length,D=0;D<z;D++){if(-1!==i.core.arr.indexOf(B[z],E.delmid)){scope.delMids.push(B[z])}}}if(E.html){var A=document.createDocumentFragment();var C=i.C("DIV");C.innerHTML=E.html;setTimeout(function(){var F=i.sizzle("div.liveStream_mainFeed_list",C);f[s]=g(F);u()},0)}else{u()}};var x=function(z){u()};i.ajax({url:w.url,args:y,onComplete:v,onFail:x})};var q=function(){var v=f[s].pop();if(p.style.display==="none"){return}p.insertBefore(v,p.firstChild);i.comp.widget.live.slidedown(v);setTimeout(function(){u()},2000)};var u=function(){if(p.style.display=="none"||l){setTimeout(function(){u()},30);return}if(f[s].length===0){return}q()};setTimeout(function(){u()},3000)};return function(t,s){var r={};var u=function(){if(!i.E("tabs")||!i.E("live_content")){return}var v=i.sizzle('[node-type="box"]',i.E("live_content"));var w=i.sizzle("div.liveStream_main_feedMore > a",i.E("live_content"));v=[v[0],v[1]];setTimeout(function(){j(v,function(x,y){if(!x){return}m(x,y);if(w[y]){c(x,w[y],y)}})},0)};var p=function(){};var q=function(){};u();r.destroy=q;return r}});STK.register("common.diy.slider",function(c){var b=c.addEvent,a=c.core.dom.getStyle;setStyle=c.core.dom.setStyle;return function(d,g){if(!d){throw"it need node for slider"}var f={};var e=function(){var m={step:1,speed:1000,show:3,auto:true,pause:2000,dir:"left",vertical:false,continuous:true,controlsFade:true};var x=c.parseParam(m,g);var p={};p.prevBtn=d.prev;p.nextBtn=d.next;p.slider=d.slider;p.btnlist=[];var r=p.slider.getElementsByTagName("ul")[0];var v=r.getElementsByTagName("li");var q=v.length;var k=v[0].offsetWidth+parseInt(a(v[0],"marginLeft"))+parseInt(a(v[0],"marginRight"));var w=v[0].offsetHeight+parseInt(a(v[0],"marginTop"))+parseInt(a(v[0],"marginBottom"));var s=Math.floor((q-x.show)/x.step);var o=0;var u=true;setStyle(p.slider,"overflow","hidden");setStyle(r,"width",q*k+"px");if(!x.vertical){for(var n=0;n<q;n++){setStyle(v[n],"float","left")}}b(p.prevBtn,"click",function(){t("prev",true)});b(p.nextBtn,"click",function(){t("next",true)});var l={set:function(z){if(p.btnlist.length===0){return}for(var y=0;y<p.btnlist.length;y++){c.removeClassName(p.btnlist[y],"current")}c.addClassName(p.btnlist[z],"current")},add:function(){var A=Math.floor(q/x.show);for(var z=0;z<A;z++){var y=c.C("a");y.href="javascript:;";y.innerHTML=parseInt(z+1);y.onclick=(function(i){return function(){l.scroll(i)}})(z)}},scroll:function(y){var i="next";if(y===o){return}else{if(y<o){o=y+1;i="prev"}else{o=y-1}}t(i,false)}};if(q/x.show>=2){}else{setStyle(p.prevBtn,"display","none");setStyle(p.nextBtn,"display","none")}function t(z,A){var B=o;switch(z){case"next":o=(B>=s)?(x.continuous?0:s):o+1;break;case"prev":o=(o<=0)?(x.continuous?s:0):o-1;break;case"first":o=0;break;case"last":o=s;break;default:break}var y=c.core.ani.tween(r);var i;if(!x.vertical){i=(o*k*x.step*-1);y.play({marginLeft:i})}else{i=(o*w*-1);y.play({marginTop:i})}if(x.controlsFade){if(o==0){u=false;c.removeClassName(p.prevBtn,"page_ok");c.addClassName(p.nextBtn,"page_ok")}else{if(o==s){u=false;c.addClassName(p.prevBtn,"page_ok");c.removeClassName(p.nextBtn,"page_ok")}else{u=true;c.addClassName(p.prevBtn,"page_ok");c.addClassName(p.nextBtn,"page_ok")}}}l.set(o);if(A||!u){clearTimeout(j)}if(x.auto&&(u||x.continuous)){j=setTimeout(function(){t(z,false)},x.speed+x.pause)}}var j;if(x.auto){j=setTimeout(function(){t("next",false)},x.pause)}if(x.controlsFade){c.removeClassName(p.prevBtn,"page_ok");c.addClassName(p.nextBtn,"page_ok");l.set(0)}};var h=function(){e()};h();f.slider=e;return f}});STK.register("module.layer",function(b){var c=function(e){var d={};if(e.style.display=="none"){e.style.visibility="hidden";e.style.display="";d.w=e.offsetWidth;d.h=e.offsetHeight;e.style.display="none";e.style.visibility="visible"}else{d.w=e.offsetWidth;d.h=e.offsetHeight}return d};var a=function(g,f){f=f||"topleft";var e=null;if(g.style.display=="none"){g.style.visibility="hidden";g.style.display="";e=b.core.dom.position(g);g.style.display="none";g.style.visibility="visible"}else{e=b.core.dom.position(g)}if(f!=="topleft"){var d=c(g);if(f==="topright"){e.l=e.l+d.w}else{if(f==="bottomleft"){e.t=e.t+d.h}else{if(f==="bottomright"){e.l=e.l+d.w;e.t=e.t+d.h}}}}return e};return function(h){var k=b.core.dom.builder(h);var g=k.list.outer[0],e=k.list.inner[0];var j=b.core.dom.uniqueID(g);var i={};var d=b.core.evt.custEvent.define(i,"show");b.core.evt.custEvent.define(d,"hide");var f=null;i.show=function(){g.style.display="";b.core.evt.custEvent.fire(d,"show");return i};i.hide=function(){g.style.display="none";b.custEvent.fire(d,"hide");return i};i.getPosition=function(l){return a(g,l)};i.getSize=function(l){if(l||!f){f=c.apply(i,[g])}return f};i.html=function(l){if(l!==undefined){e.innerHTML=l}return e.innerHTML};i.text=function(l){if(text!==undefined){e.innerHTML=b.core.str.encodeHTML(l)}return b.core.str.decodeHTML(e.innerHTML)};i.appendChild=function(l){e.appendChild(l);return i};i.getUniqueID=function(){return j};i.getOuter=function(){return g};i.getInner=function(){return e};i.getParentNode=function(){return g.parentNode};i.getDomList=function(){return k.list};i.getDomListByKey=function(l){return k.list[l]};i.getDom=function(m,l){if(!k.list[m]){return false}return k.list[m][l||0]};i.getCascadeDom=function(m,l){if(!k.list[m]){return false}return b.core.dom.cascadeNode(k.list[m][l||0])};return i}});STK.register("ui.tipPrototype",function(a){var b=10003;return function(d){var e,i,h,g,c;var f='<div node-type="outer" class="WB_widgets W_layer" style="position: absolute; display:none;" ><div node-type="inner" class="bg"></div></div>';e=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty},d);i=a.module.layer(f,e);h=i.getOuter();g=i.getInner();i.setTipWH=function(){c=this.getSize(true);this.tipWidth=c.w;this.tipHeight=c.h;return this};i.setTipWH();i.setContent=function(j){if(typeof j=="string"){g.innerHTML=j}else{g.appendChild(j)}this.setTipWH();return this};i.setLayerXY=function(p){if(!p){throw"ui.tipPrototype need pNode as first parameter to set tip position"}var q=STK.core.dom.position(p);var l=q.l;var o=p.offsetWidth;var k=p.offsetHeight;var n=Math.min(Math.max((l+(o-this.tipWidth)/2),a.scrollPos().left),(a.scrollPos().left+STK.winSize().width)-this.tipWidth);var m=q.t;if(e.direct==="down"){m+=k}var j=[";"];j.push("z-index:",(b++),";");j.push("width:",this.tipWidth,"px;");j.push("height:",this.tipHeight,"px;");j.push("top:",m,"px;");j.push("left:",n,"px;");h.style.cssText+=j.join("")};i.aniShow=function(){var k=this.getOuter();k.style.height="0px";k.style.display="";var j=a.core.ani.tween(k,{end:e.showCallback,duration:250,animationType:"easeoutcubic"});if(e.direct==="down"){j.play({height:this.tipHeight},{staticStyle:"overflow:hidden;position:absolute;"})}else{var l=(parseInt(k.style.top,10)-this.tipHeight);j.play({height:this.tipHeight,top:Math.max(l,a.scrollPos().top)},{staticStyle:"overflow:hidden;position:absolute;"})}};i.anihide=function(){var k=this.getOuter();var m=this;var j=a.core.ani.tween(k,{end:function(){k.style.display="none";k.style.height=m.tipHeight+"px";e.hideCallback()},duration:300,animationType:"easeoutcubic"});if(e.direct==="down"){j.play({height:0},{staticStyle:"overflow:hidden;position:absolute;"})}else{var l=(parseInt(k.style.top,10)+this.tipHeight);j.play({height:0,top:l},{staticStyle:"overflow:hidden;position:absolute;"})}};document.body.appendChild(h);i.destroy=function(){document.body.removeChild(h);i=null};return i}});STK.register("ui.tipAlert",function(a){var b=a.core.util.easyTemplate;return function(c){c=a.parseParam({direct:"up",className:"WB_widgets W_layer",showCallback:a.core.func.empty,hideCallback:a.core.func.empty,template:'<#et temp data><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div node-type="msgDiv" class="content layer_mini_info"><p class="clearfix alt_text"><span class="tip_icon WB_tipS_${data.type}"></span>${data.msg}&nbsp; &nbsp; &nbsp; </p></div></td></tr></tbody></table></#et>',type:"ok",msg:""},c);var g=a.ui.tipPrototype(c);var h=g.getInner();var e=g.getOuter();e.className=c.className;h.className="bg";var f=c.template;var i=a.builder(b(f,{type:c.type,msg:c.msg}).toString());g.setContent(i.box);var d=g.destroy;g.destroy=function(){d();g=null};return g}});STK.register("common.widget.reg",function(c){var a=c.kit.extra.language;var b=c.ui.tipAlert({className:"WB_tips_top",showCallback:function(){var d=b.getOuter();d.style.height="";d=null},template:'<#et temp data><div class="tips_inner"><span class="WB_tipS_warn"></span><span class="WB_icon_txt">'+a("#L{您的帐号尚未开通微博，}")+'<a href="http://weibo.com/signup/full_info.php?appsrc=6cm7D0&backurl='+encodeURIComponent(document.URL)+'&showlogo=0&vsrc=weiboshow&from=zw" target="_blank">'+a("#L{立即开通}")+"</a></span></#et>"});return function(d){if(!c.isNode(d)){throw"[common.widget.reg] need node as first parameter"}b.setLayerXY(d);b.aniShow();return b}});STK.register("common.widget.addFollow",function(e){var d=e.kit.extra.language;var c=e.core.json.queryToJson;var b=function(){},a={uid:scope.loginKit().uid,url:"",fuid:"",appsrc:"",vsrc:"app_weiboshow",success:b,fail:b,btnTemp:""};var h;var f=function(i){if(i.fuid===i.uid){h.parentNode.innerHTML=d('<span class="WB_btnC"><span><em class="WB_btnicn_ok"></em><em>#L{你自己}</em></span></span>');return"yourself"}if(!i.url){i.url="/widget/weiboshow/aj_attention.php";if(/weibo.com/.test(location.host)){i.url="/weiboshow/aj_attention.php"}}var j=i.btnTemp||'<span class="WB_btnC"><span><em class="WB_btnicn_ok"></em><em>#L{已关注}</em></span></span>';e.ajax({method:"post",url:i.url,args:{wsrc:$CONFIG.wsrc||"app_weibo_show",uid:i.uid,fuid:i.fuid},onComplete:function(l){switch(l.code){case"A00006":break;case"A10007":break;case -1:e.common.widget.reg(h);break;case -2:var k=e.common.widget.login();e.custEvent.add(k,"login",function(){i.uid=scope.loginKit().uid;f(i)});k.showLogin();break;case -3:break}if((l.code=="A00006"||l.code=="A10007")&&h){h.parentNode.innerHTML=d(j)}typeof i.success==="function"&&i.success(l)},onFail:function(k){typeof i.fail==="function"&&i.fail(k)}})};var g=function(k){var j=k.getAttribute("action-data");if(!j){return}var i=c(j);i.uid&&window.open("http://www.weibo.com/u/"+i.uid+"?refer_flag=2725420000_weiboxiu")};return function(n,m){if(!n){throw"[common.widget.addFollow] need node as parameter";return}h=n;var j=function(){if(parent!=self&&parent!=parent.parent){return}if(!scope.$isLogin()){var p=e.common.widget.login();e.custEvent.add(p,"login",function(){m.uid=scope.loginKit().uid;g(n)});p.showLogin();return}g(n)};var l={};var o=function(){m=e.parseParam(a,m);if(!m.fuid){m.fuid=n.getAttribute("uid")}i()};var i=function(){e.addEvent(n,"click",j)};var k=function(){e.removeEvent(n,"click",j)};l.destroy=k;o();return l}});STK.register("comp.widget.live.follow",function(f){var i=f.common.trans.live;var a,l,j,k,m,b,d;var h=function(){if(scope.uids.length>0){var n=i.getTrans("relations",{onComplete:function(q){var o=q.uid.length;scope.pubCount++;if(q.code==="A00006"&&o>0){for(var p=0;p<o;p++){var r=f.E("uid"+q.uid[p]);c(r)}}bindDOM()}});n.request({uids:scope.uids.join(",")})}};var e=function(o){var n=parseInt(f.core.dom.getStyle(j,"marginLeft"));d.play({marginLeft:n-m});return false},g=function(o){var n=f.core.dom.getStyle(j,"marginLeft");d.play({marginLeft:n+m});return false};var c=function(o){if(!o){return}var n=f.sizzle("span.liveStream_followList_action",o)[0];if(n){var p=document.createElement("span");p.className="liveStream_followList_have";p.innerHTML="<em></em";n.parentNode.replaceChild(p,n);p=null;n=null}};return function(r){var q={};var t=function(){if(!r){return}s();h();n()};var s=function(){a=f.sizzle('[node-type="prevBtn"]',r)[0];l=f.sizzle('[node-type="nextBtn"]',r)[0];j=f.sizzle('[node-type="fansList"]',r)[0];var u=f.sizzle('[node-type="slider"]',r)[0];k=f.sizzle("li",j);if(k.length===0){a.style.display="none";l.style.display="none";return}f.common.diy.slider({slider:u,prev:a,next:l},{step:1,speed:1000,show:7,auto:false,pause:2000,dir:"left",vertical:false,continuous:false,controlsFade:true})};var o=function(A,x){if(parent!=self&&parent!=parent.parent){return}if(!scope.$isLogin()){var u=f.common.widget.login();var w=arguments;f.custEvent.add(u,"login",function(){o.apply(this,w)});u.showLogin();return}var z={wsrc:$CONFIG.wsrc||"app_live_stream",uid:x,login:scope.postLogin},v="aj_attention.php";if(scope.refer){z.refer=scope.refer}var y=i.getTrans("addFollow",{onComplete:function(B){if(B.code==="A00006"){c(A)}else{if(B.msg){alert(B.msg)}}}});y.request(z)};var n=function(){var v=f.sizzle('[node-type="fansList"] span.liveStream_followList_action',r);var u=v.length;while(u--){f.addEvent(v[u],"click",function(w){return function(z){f.stopEvent();var x=v[w].parentNode.parentNode;var y=x.getAttribute("uid");o(x,y)}}(u))}};var p=function(){};t();q.destroy=p;return q}});STK.register("common.diy.hover",function(a){return function(e,c,f){var b=e.className;var d=e.style.cssText;a.addEvent(e,"mouseover",function(){c(e)});if(!f||typeof f!="function"){a.addEvent(e,"mouseout",function(){e.className=b;e.style.cssText=d})}else{a.addEvent(e,"mouseout",function(){f(e)})}}});STK.register("comp.widget.live.slidedown",function(b){var a=b.common.diy.hover;return function(f,g){if(!b.isNode(f)){f=b.E(f)}var c=f.offsetHeight;f.style.height="0";f.style.overflow="hidden";f.style.display="";var e=function(){f.style.overflow="";f.style.height="";d.destroy();typeof g==="function"&&g()};var d=STK.core.ani.tween(f,{end:e});d.play({height:c});a(f,function(h){h.className="liveStream_mainFeed_list liveStream_mainFeed_list_focus clearfix"},function(h){h.className="liveStream_mainFeed_list clearfix"})}});if(typeof scope==="undefined"){var scope={}}if(!scope.refer_content){scope.refer_content=""}scope.pubCount=0;STK.register("comp.widget.live.init",function(g){var q=g.addEvent,e=g.getEvent,t=g.trim,f=g.reomveEvent,d=g.sizzle,n=g.ajax,x=g.fireEvent,u=g.stopEvent,o=g.kit.extra.language,a=g.common.editor.getLength,m=g.common.editor.flashContent,y=g.common.trans.live,b=2000,j,v;scope.delMids=[];var l=function(){if(!j){return}j.value="#"+decodeURIComponent(scope.puptopic)+"#";g.fireEvent(j,"keyup")};function p(z){var A=g.core.dom.next(z);if(A){g.removeNode(A)}}var k=function(z){z=z.box;p(j);g.insertAfter(z,j);setTimeout(function(){p(j)},2000)},s=function(){var z=g.builder(o('<p class="commentInput_state"><span class="WB_tipS_ok commentInput_state_icon"></span>#L{发布成功}</p>'));k(z)},r=function(A){A=A||"#L{发表微博失败}";var z=g.builder(o('<p class="commentInput_state"><span class="WB_tipS_err commentInput_state_icon"></span>'+A+'<a href="###" node-type="backBtn">#L{返回}</a></p>'));g.addEvent(z.list.backBtn,"click",function(){z.style.display="none";return false});k(z)};var i=function(){var C=g.trim(j.value),z=a(C);if(z>b||z==0){m(j);return}if(!scope.loginKit().isLogin){var A=g.common.widget.login({vsrc:"app_livestream",appsrc:scope.appsrc});g.custEvent.add(A,"login",function(){i()});A.showLogin()}if(v==true){return}v=true;C+=scope.refer_content;var B={appkey:scope.appkey,refer:scope.refer,language:scope.$language,url_param:scope.url_param,content:encodeURIComponent(C)};tran=y.getTrans("addmblog",{onComplete:function(F){if(F.code==="A00006"){if(F.html){var E=document.createElement("DIV");E.innerHTML=F.html;var G=g.sizzle(".liveStream_mainFeed_list",E)[0];var D=g.sizzle('[node-type="box"]',g.E("live_content"))[0];D.insertBefore(G,D.firstChild);g.comp.widget.live.slidedown(G)}if(F.delmid){scope.delMids.push(F.delmid)}l();s()}else{r(F.msg)}v=null},onError:function(){v=null},onFail:function(){v=null}});tran.request(B);return false};var c=g.C("div");c.className=" WB_widgets WB_widgets_layer_picshow";var w=function(B){var A=B.el;var C=B.data.src;var z=new Image();z.onload=function(){var D=g.E("live_content").offsetWidth;var F=g.position(A);var E=F.l;if(parseInt(E+z.width)>D){E=D-z.width-2}c.style.left=E+"px";c.style.top=(F.t+A.offsetHeight+2)+"px";c.style.display="block"};z.src=C;c.appendChild(z)},h=function(){c.style.display="none";c.innerHTML=""};return function(E,D){var C={},A;var F=function(){var I=new Image();var H="//rs.sinajs.cn/tmp.gif?";H+="id=live&action=pv";H+="&uid="+($CONFIG.$uid||0);H+="&url="+encodeURIComponent(document.referrer);H+="&r="+(new Date()).valueOf();I.src=H};var G=function(){z();E.appendChild(c);A=g.comp.widget.live.repost_comm(g.E("live_content"));g.comp.widget.live.follow(g.E("pl_live_fans"));g.comp.widget.live.style();b-=a((scope.refer_content=="")?"":" "+scope.refer_content);g.comp.widget.live.loadmore();F()};var z=function(){j=g.sizzle('[node-type="editor"]',g.E("publisher"))[0];l();g.E("publisher")&&g.common.editor.simpleEditorNew(g.E("publisher"),{limit:b,warnClassName:"txt_num err_num",className:"txt_num"});var I=g.sizzle('div[node-type="box"]',E);var H=g.E("tabs"),J=g.sizzle("li",H);if(I.length>1&&J.length>1){g.module.tabs(H,{tabNode:"li",boxNode:I,callback:function(){}})}g.addEvent(g.E("publisherBtn"),"click",i);g.core.evt.hotKey.add(j,"ctrl+Enter",i);var K=g.delegatedEvent(E);K.add("showpic","mouseover",w);K.add("showpic","mouseout",h)};var B=function(){g.removeEvent(g.E("publisherBtn"),"click",i);g.core.evt.hotKey.remove(j,"ctrl+Enter",i);A.destroy()};G();C.destroy=B;return C}});STK.pageletM.register("pl.widget.live",function(d){try{var c={};var b=d.E("pl_live");var a=d.comp.widget.live.init(b,c);return a}catch(f){}});STK.pageletM.start();